var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),jadeStatic=require("connect-jade-static"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,db=require("./model/db"),blob=require("./model/blobs"),users=require("./model/user"),routes=require("./routes/index"),blobs=require("./routes/blobs"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","jade"),app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(require("node-compass")({mode:"expanded"})),app.use(express["static"](path.join(__dirname,"public"))),app.use("/bower_components",express["static"](__dirname+"/bower_components")),app.use(jadeStatic({baseDir:path.join(__dirname,"/views/partials"),baseUrl:"/partials",maxAge:86400,jade:{pretty:!0}})),app.use(passport.initialize()),app.use(passport.session()),passport.serializeUser(function(s,e){e(null,s._id)}),passport.deserializeUser(function(s,e){User.findById(s,function(s,r){e(s,r)})}),passport.use("login",new LocalStrategy({usernameField:"email",passwordField:"password",passReqToCallback:!0,session:!0},function(s,e,r,p){})),app.use("/",routes),app.use("/blobs",blobs),app.use(function(s,e,r){var p=new Error("Not Found");console.log(p),p.status=404,r(p)}),"development"===app.get("env")&&app.use(function(s,e,r,p){r.status(s.status||500),r.render("error",{message:s.message,error:s})}),app.use(function(s,e,r,p){r.status(s.status||500),r.render("error",{message:s.message,error:{}})}),module.exports=app;var gulp=require("gulp"),jshint=require("gulp-jshint"),jscs=require("gulp-jscs"),stylish=require("gulp-jscs-stylish"),sass=require("gulp-sass"),concat=require("gulp-concat"),uglify=require("gulp-uglify"),rename=require("gulp-rename"),install=require("gulp-install"),babel=require("gulp-babel"),scsslint=require("gulp-scss-lint"),scssLintStylish=require("gulp-scss-lint-stylish");gulp.task("install",function(){return gulp.src([".bower.json","./package.json"]).pipe(install())}),gulp.task("sass",function(){return gulp.src("public/stylesheets/*.scss").pipe(sass().on("error",sass.logError)).pipe(gulp.dest("public/stylesheets/"))}),gulp.task("js-lint",function(){return gulp.src("*.js").pipe(jshint()).pipe(jscs()).on("error",function(){}).pipe(stylish.combineWithHintResults()).pipe(jshint.reporter("gulp-jshint-file-reporter",{filename:__dirname+"/logs/jshint-output.log"}))}),gulp.task("scss-lint",function(){return gulp.src("public/stylesheets/*.scss").pipe(scsslint({customReport:scssLintStylish,endless:!0,config:"scss-lint.yml",reporterOutput:__dirname+"/logs/scssReport.json"})).pipe(gulp.dest("./reports"))}),gulp.task("scripts",function(){return gulp.src("*.js").pipe(concat("all.js")).pipe(gulp.dest("dist")).pipe(rename("all.min.js")).pipe(uglify()).pipe(gulp.dest("dist"))}),gulp.task("babel",function(){}),gulp.task("watch",function(){gulp.watch("*.js",["js-lint","scss-lint","scripts"]),gulp.watch("*.scss",["sass"])}),gulp.task("default",["install","sass","js-lint","scss-lint","scripts","watch"]);var install=require("gulp-install");gulp.src(__dirname+"/templates/**").pipe(gulp.dest("./")).pipe(install({allowRoot:!0}));